<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-api docs-version-current docs-doc-page docs-doc-id-zkvm/developer-guide/optimization" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Guest Optimization Guide | RISC Zero Developer Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://dev.risczero.com/website-preview/risc0/risc0/pr/1127/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://dev.risczero.com/website-preview/risc0/risc0/pr/1127/img/logo.png"><meta data-rh="true" property="og:url" content="https://dev.risczero.com/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/optimization"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-api-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-api-current"><meta data-rh="true" property="og:title" content="Guest Optimization Guide | RISC Zero Developer Docs"><meta data-rh="true" name="description" content="RISC Zero’s zkVM is designed and built to act like a physical CPU."><meta data-rh="true" property="og:description" content="RISC Zero’s zkVM is designed and built to act like a physical CPU."><link data-rh="true" rel="icon" href="/website-preview/risc0/risc0/pr/1127/img/logo.png"><link data-rh="true" rel="canonical" href="https://dev.risczero.com/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/optimization"><link data-rh="true" rel="alternate" href="https://dev.risczero.com/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/optimization" hreflang="en"><link data-rh="true" rel="alternate" href="https://dev.risczero.com/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/optimization" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TQC8F4X8Z5-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="RISC Zero Developer Docs" href="/website-preview/risc0/risc0/pr/1127/opensearch.xml">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="https://plausible.io/js/script.js" data-domain="risczero.com" defer="defer"></script><link rel="stylesheet" href="/website-preview/risc0/risc0/pr/1127/assets/css/styles.5537c1c2.css">
<script src="/website-preview/risc0/risc0/pr/1127/assets/js/runtime~main.a95589d4.js" defer="defer"></script>
<script src="/website-preview/risc0/risc0/pr/1127/assets/js/main.9360b09f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://risczero.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/website-preview/risc0/risc0/pr/1127/img/logo.png" alt="RISC Zero Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/website-preview/risc0/risc0/pr/1127/img/logo.png" alt="RISC Zero Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">RISC Zero</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/website-preview/risc0/risc0/pr/1127/api/">Introduction</a><a class="navbar__item navbar__link" href="/website-preview/risc0/risc0/pr/1127/terminology">Terminology</a><a class="navbar__item navbar__link" href="/website-preview/risc0/risc0/pr/1127/faq">FAQ</a><a class="navbar__item navbar__link" href="/website-preview/risc0/risc0/pr/1127/studyclub">Resources</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/website-preview/risc0/risc0/pr/1127/api/next/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/optimization">Next</a></li><li><a class="dropdown__link" href="/website-preview/risc0/risc0/pr/1127/api/">0.19</a></li><li><a class="dropdown__link" href="/website-preview/risc0/risc0/pr/1127/api/0.18/">0.18</a></li></ul></div><a href="https://github.com/risc0" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a href="https://discord.gg/risczero" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://twitter.com/risczero" target="_blank" rel="noopener noreferrer" class="dropdown__link">Twitter<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.youtube.com/@risczero" target="_blank" rel="noopener noreferrer" class="dropdown__link">YouTube<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://stackoverflow.com/questions/tagged/risczero" target="_blank" rel="noopener noreferrer" class="dropdown__link">Stack Overflow<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/website-preview/risc0/risc0/pr/1127/contributors-guide">Contributor&#x27;s Guide</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/website-preview/risc0/risc0/pr/1127/api/next/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/website-preview/risc0/risc0/pr/1127/api/next/bonsai/">Bonsai</a><button aria-label="Collapse sidebar category &#x27;Bonsai&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/bonsai/quickstart">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/bonsai/bonsai-on-eth">Bonsai on Ethereum</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/bonsai/blockchain-zkvm-guide">A Blockchain Dev&#x27;s Guide to zkVM Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/bonsai/eth-examples">Ethereum Examples</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/bonsai/rest-api">REST API</a><button aria-label="Collapse sidebar category &#x27;REST API&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a href="https://api.bonsai.xyz/swagger-ui/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">API Reference Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/">zkVM</a><button aria-label="Collapse sidebar category &#x27;zkVM&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/quickstart">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/dev-mode">Dev Mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://docs.rs/risc0-zkvm/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">API Reference Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/install">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/rust-resources">Rust Resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/guest-code-101">Guest Code 101</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/host-code-101">Host Code 101</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/receipts">Receipts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/optimization">Guest Optimization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/acceleration">Cryptography Acceleration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/profiling">Profiling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/zkvm-specification">zkVM technical specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/benchmarks">Performance Benchmarks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/tutorials/overview">Tutorials</a><button aria-label="Collapse sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/tutorials/hello-world">Hello World Tutorial</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/examples">Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://github.com/risc0/risc0" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Source code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->RISC Zero Developer Docs<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/website-preview/risc0/risc0/pr/1127/api/">latest version</a></b> (<!-- -->0.19<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/website-preview/risc0/risc0/pr/1127/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/"><span itemprop="name">zkVM</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Guest Optimization</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Guest Optimization Guide</h1>
<p>RISC Zero’s zkVM is designed and built to act like a physical CPU.
We did this so you could use general purpose languages (e.g. Rust) and general purpose tools (e.g. Cargo, LLVM). <strong>Generally, you can apply general purpose optimization techniques too!</strong></p>
<p>In this guide, we’ll cover optimization of <a href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/guest-code-101">zkVM guest programs</a>.
We’ll discuss when you can apply common techniques from other contexts, and when you need a new approach.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-the-zkvm-really">What is the zkVM, really?<a href="#what-is-the-zkvm-really" class="hash-link" aria-label="Direct link to What is the zkVM, really?" title="Direct link to What is the zkVM, really?">​</a></h3>
<p><strong>The zkVM is essentially a CPU.</strong></p>
<p>In particular, it is an implementation of the <a href="/website-preview/risc0/risc0/pr/1127/reference-docs/about-risc-v">RISC-V architecture</a> (specifically riscv32im), similar to how your laptop’s CPU may be an implementation of an <a href="https://en.wikipedia.org/wiki/X86" target="_blank" rel="noopener noreferrer">x86</a> or <a href="https://en.wikipedia.org/wiki/ARM_architecture_family" target="_blank" rel="noopener noreferrer">ARM</a> architecture.
This biggest difference is that the zkVM is implemented with <a href="/website-preview/risc0/risc0/pr/1127/reference-docs/about-arithmetic-circuits">arithmetic circuits</a>, in software, instead of circuitry made from silicon and copper.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-a-cycle">What is a “cycle”?<a href="#what-is-a-cycle" class="hash-link" aria-label="Direct link to What is a “cycle”?" title="Direct link to What is a “cycle”?">​</a></h3>
<p>Both in the zkVM and on physical CPUs, the cost of an operation is measured in “clock cycles”.</p>
<p>Intuitively, a &quot;clock cycle&quot; is the smallest unit of time in a CPU&#x27;s operation, representing one tick of the CPU&#x27;s internal clock and the time it takes to execute a basic CPU operation (e.g. adding two integers).
We’ll refer to this as a “cycle”. <sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
<p><strong>Proving times for the zkVM are directly related to the number of cycles in an execution.</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="general-techniques-and-advice">General techniques and advice<a href="#general-techniques-and-advice" class="hash-link" aria-label="Direct link to General techniques and advice" title="Direct link to General techniques and advice">​</a></h2>
<p><strong>Start by applying general techniques and best practices for optimizing your code.</strong></p>
<p><a href="https://nnethercote.github.io/perf-book/" target="_blank" rel="noopener noreferrer">The Rust Performance Book</a> is great resource.
It’s not very long, it covers a range of topics important to performance, and gives applicable advice for optimization.
If you are new to optimization, or new to Rust, we recommend you read this guide.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dont-assume-measure">Don’t assume, measure.<a href="#dont-assume-measure" class="hash-link" aria-label="Direct link to Don’t assume, measure." title="Direct link to Don’t assume, measure.">​</a></h3>
<p>Performance is complex, in the zkVM as on a physical CPU.
Don’t assume you know what the bottlenecks are. Measure and experiment.</p>
<p>If you make a function 100x faster (or ∞x faster) but it only takes 1% of your execution time, you’ll see less than 1% improvement in performance.
This is generally referred to as <a href="https://en.wikipedia.org/wiki/Amdahl%27s_law" target="_blank" rel="noopener noreferrer">Amdahl’s Law</a>, and practically it means you shouldn&#x27;t waste your time optimizing something that&#x27;s not the taking a significant portion of execution time.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="measuring-by-printing-to-console">Measuring by printing to console<a href="#measuring-by-printing-to-console" class="hash-link" aria-label="Direct link to Measuring by printing to console" title="Direct link to Measuring by printing to console">​</a></h3>
<p>Starting simple, measure by adding an <code>eprintln!</code> line to your guest code to measure how long an operation takes, and how many times it is called.</p>
<p>Using <a href="https://docs.rs/risc0-zkvm/0.19/risc0_zkvm/guest/env/fn.get_cycle_count.html" target="_blank" rel="noopener noreferrer"><code>env::get_cycle_count()</code></a> will tell you the current number of execution cycles that have occurred in your program.</p>
<p>As an example:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">methods/guest/src/main.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">my_operation_to_measure</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> start </span><span class="token operator">=</span><span class="token plain"> </span><span class="token namespace">env</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">get_cycle_count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// potentially expensive or frequently called code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> end </span><span class="token operator">=</span><span class="token plain"> </span><span class="token namespace">env</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">get_cycle_count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token macro property">eprintln!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;my_operation_to_measure: {}&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> end </span><span class="token operator">-</span><span class="token plain"> start</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When you run your guest, you’ll see a printout of the cycle count each time that function is called.
You can then analyze this data easily with a tool like <a href="https://github.com/nnethercote/counts/" target="_blank" rel="noopener noreferrer"><code>counts</code></a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="profiling">Profiling<a href="#profiling" class="hash-link" aria-label="Direct link to Profiling" title="Direct link to Profiling">​</a></h3>
<p><strong>Profiling is one of the most important tools for understanding and optimizing your code.</strong></p>
<p>Profiling tools, like <a href="https://github.com/google/pprof" target="_blank" rel="noopener noreferrer">pprof</a> and <a href="https://perf.wiki.kernel.org/index.php/Main_Page" target="_blank" rel="noopener noreferrer">perf</a>, allow collecting performance information over the entire execution of your program, and help create visualizations for the performance of your program.
RISC Zero has experimental support for generating pprof files for cycle counts.</p>
<p><a href="https://nikhilism.com/post/2018/sampling-profiler-internals-introduction/" target="_blank" rel="noopener noreferrer">Sampling CPU profilers</a>, as implemented by pprof and perf, provide a view of where your program is spending its time.
It does so by recording the current call stack at a sampling interval.
RISC Zero provides a &quot;sampling&quot; <sup><a href="#user-content-fn-2" id="user-content-fnref-2" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup> CPU profiler for guest execution.</p>
<p>One very useful visualization of this data is as a <a href="https://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html" target="_blank" rel="noopener noreferrer">flamegraph</a>, such as the one below for the <a href="https://github.com/risc0/risc0/tree/v0.19.0/examples/ecdsa" target="_blank" rel="noopener noreferrer">ECDSA verification example</a>.</p>
<p><img loading="lazy" alt="ECDSA verification flamegraph" src="/website-preview/risc0/risc0/pr/1127/assets/images/ecdsa-verification-flamegraph-1bbb98199aeeccb65f92679600a3e3e6.png" width="1812" height="456" class="img_ev3q"></p>
<p>Generate this profile and flamegraph by <a href="https://go.dev/doc/install" target="_blank" rel="noopener noreferrer">installing Go</a> and running the following commands:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># In your clone of github.com/risc0/risc0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> examples/ecdsa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">RISC0_PPROF_OUT</span><span class="token operator">=</span><span class="token plain">ecdsa_verify.pb </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">RISC0_DEV_MODE</span><span class="token operator">=</span><span class="token plain">true </span><span class="token function" style="color:rgb(80, 250, 123)">cargo</span><span class="token plain"> run </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-F</span><span class="token plain"> profiler</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">go tool pprof </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-http</span><span class="token plain"> </span><span class="token number">127.0</span><span class="token plain">.0.1:8000 ecdsa_verify.pb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Open <a href="http://127.0.0.1:8000/ui/flamegraph" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8000/ui/flamegraph</a> in your web browser to see the flamegraph.</p>
<p>Although it’s bundled with Go, the <code>pprof</code> tool can be used with profiles from programs not written in Golang.
<code>pprof</code> has extensive functionality, and the documentation linked below contains information about the different views provided, comparing profiles, and much more.</p>
<p>Documentation for <code>pprof</code>: <a href="https://github.com/google/pprof/blob/main/doc/README.md" target="_blank" rel="noopener noreferrer">github.com/google/pprof</a></p>
<p><strong>More information about profiling can be found in the <a href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/profiling">Guest Profiling Guide</a></strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-differences">Key Differences<a href="#key-differences" class="hash-link" aria-label="Direct link to Key Differences" title="Direct link to Key Differences">​</a></h2>
<p>Using general purpose advice and tools for optimization will work 80% of the time.
But there are some key differences between how physical CPUs and the zkVM operate that can be important to understand when trying to get the best possible guest performance.</p>
<p><strong>This section explains some of the most important differences between a physical CPU and the zkVM, as they relate to guest performance.</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="most-risc-v-operations-take-exactly-one-cycle">Most <a href="https://mark.theis.site/riscv/" target="_blank" rel="noopener noreferrer">RISC-V operations</a> take exactly one cycle<a href="#most-risc-v-operations-take-exactly-one-cycle" class="hash-link" aria-label="Direct link to most-risc-v-operations-take-exactly-one-cycle" title="Direct link to most-risc-v-operations-take-exactly-one-cycle">​</a></h3>
<p><strong>Not all operations cost the same amount.</strong>
An <code>add</code> instruction takes fewer cycles than a <code>div</code>. This is true for both the zkVM and physical CPUs.</p>
<p>However, the relative difference between instructions is much smaller in the zkVM.
In the zkVM, a <code>div</code> takes twice as long as an <code>add</code>.
On a physical CPU, a <code>div</code> takes <a href="http://ithare.com/infographics-operation-costs-in-cpu-clock-cycles/" target="_blank" rel="noopener noreferrer">15-40 times</a> as long compared to an <code>add</code>.
Practically, this means if you have a choice between implementing <a href="https://briansmith.org/ecc-inversion-addition-chains-01" target="_blank" rel="noopener noreferrer">an algorithm</a> with 10 <code>add</code> ops, or a single <code>div</code>. On a physical CPU, choose the <code>add</code> ops. In the zkVM choose the <code>div</code>.</p>
<ul>
<li>Addition, comparison, jump, shift left, load and store all take one cycle.</li>
<li>Bitwise operations (AND, OR, XOR), division, remainder, and shift right take two cycles.</li>
</ul>
<p>Note that this means that shift left is no faster than multiplying by a power of two, and shift right is no faster than division.
A number of other small optimizations like this, routinely applied by developers and compilers, have no effect in the zkVM.</p>
<p>See the <a href="#rv32im-operations-with-cycle-counts">table in the appendix</a> for more information about cycle counts per operation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-access-costs-one-cycle-except-when-it-doesnt">Memory access costs one cycle, except when it doesn’t<a href="#memory-access-costs-one-cycle-except-when-it-doesnt" class="hash-link" aria-label="Direct link to Memory access costs one cycle, except when it doesn’t" title="Direct link to Memory access costs one cycle, except when it doesn’t">​</a></h3>
<p><a href="https://mark.theis.site/riscv/" target="_blank" rel="noopener noreferrer">RISC-V operations</a> require data to be loaded from memory to <a href="https://en.wikipedia.org/wiki/Processor_register" target="_blank" rel="noopener noreferrer">registers</a> before it can acted on (e.g. used as input to an <code>add</code>).
It must also be written back to memory to store the result. Memory loads and stores (i.e. reads and writes) usually take one cycle.</p>
<p>Memory access, both load and store takes exactly one cycle, expect in the case of page-in and page-out operations (<a href="#paging">discussed below</a>).</p>
<p>Note that relative to a physical CPU, this is extremely fast (in terms of cycles).
On a physical CPU even a value in <a href="https://en.wikipedia.org/wiki/Cache_hierarchy" target="_blank" rel="noopener noreferrer">L1 cache</a> takes <a href="http://ithare.com/infographics-operation-costs-in-cpu-clock-cycles/" target="_blank" rel="noopener noreferrer">3-4 cycles</a> to access.
L3 cache takes <a href="http://ithare.com/infographics-operation-costs-in-cpu-clock-cycles/" target="_blank" rel="noopener noreferrer">30-70 cycles</a> and main memory <a href="http://ithare.com/infographics-operation-costs-in-cpu-clock-cycles/" target="_blank" rel="noopener noreferrer">100-150</a>.
One of the most common bottlenecks in applications is the round-trip time it takes to access a data in memory.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="paging">Paging<a href="#paging" class="hash-link" aria-label="Direct link to Paging" title="Direct link to Paging">​</a></h4>
<p>Every execution of the zkVM starts from an initial memory state.
This memory state (a.k.a. image) is referenced by an <a href="https://dev.risczero.com/terminology#image-id" target="_blank" rel="noopener noreferrer">image ID</a>, which contains a <a href="https://en.wikipedia.org/wiki/Merkle_tree" target="_blank" rel="noopener noreferrer">Merkle root</a> committing to all data in memory.
For efficiency, data in memory is split into 1 kB pages.</p>
<p>Pages in the zkVM are analogous a <a href="https://en.wikipedia.org/wiki/Page_(computer_memory)" target="_blank" rel="noopener noreferrer">page in an operating system</a>, and in particular this term was chosen in reference to <a href="https://en.wikipedia.org/wiki/Memory_paging" target="_blank" rel="noopener noreferrer">memory paging</a>, or swapping, systems.
Execution of a program is split into <a href="https://www.risczero.com/news/continuations" target="_blank" rel="noopener noreferrer">continuation segments</a>.
Between segments, the zkVM essentially <a href="https://en.wikipedia.org/wiki/Hibernation_(computing)" target="_blank" rel="noopener noreferrer">hibernates</a>, saving all working memory to the host; as a CPU would use a hard drive.</p>
<p>The first time a page is accessed in a segment, it needs to be <strong>paged-in</strong>, loading it from the host.
Confirming the page is correct, the guest verifies a Merkle inclusion proof for the page against the image ID.
These hashing operations required take a number of cycles.</p>
<p><strong>A page-in operation takes between 1094 and 5130 cycles; 1130 cycles on average.</strong><sup><a href="#user-content-fn-3" id="user-content-fnref-3" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup></p>
<p>The very first page-in takes longer, 5130 cycles, because it needs to traverse up the page table (i.e. Merkle tree) all the way to the root, which is equal to the image ID.
Once a path is verified, it doesn’t need to be hashed again, so most page-in operations only need to hash the leaf (i.e. data) page.
If a program were to iterate over memory in sequence, it would cost on average 1130 cycles per page, or 1.35 cycles per byte.</p>
<p>In order to support continuation after the segment ends (i.e. the zkVM “hibernates”), it needs to <strong>page-out</strong> pages that were modified.
Paging-out takes the same number of operations as paging-in, so for the first time any given page is written to in a segment, there is an page-out cost of 1094 to 5130 cycles.</p>
<p>If, after profiling your application, you learn page-in and page-out operations are a significant overhead, you can optimize your application by reducing it’s memory usage and locality.
This will be somewhat similar to optimizing for data locality and L1/2 cache usage.
Using fewer pages, using the same page repeatedly instead of a random access pattern, and condensing the range of addresses accessed can all help reduce paging overhead.
It’s best to experiment.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-zkvm-does-not-have-native-floating-point-operations">The zkVM does not have native floating point operations<a href="#the-zkvm-does-not-have-native-floating-point-operations" class="hash-link" aria-label="Direct link to The zkVM does not have native floating point operations" title="Direct link to The zkVM does not have native floating point operations">​</a></h3>
<p>The RISC Zero zkVM does not implement the RISC-V floating point instructions.
As a result, all floating point operations are emulated in software.
In contrast to integer operations that take 1-2 cycles, floating point operations can take 60-140 cycles for basic operations such as add, subtract, multiply, and divide.</p>
<p><strong>When possible, use integers instead of floating point numbers.</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unaligned-data-access-is-significantly-more-expensive">Unaligned data access is significantly more expensive<a href="#unaligned-data-access-is-significantly-more-expensive" class="hash-link" aria-label="Direct link to Unaligned data access is significantly more expensive" title="Direct link to Unaligned data access is significantly more expensive">​</a></h3>
<p>CPUs define a standard size of data for operation; and this is referred to as a word.
In RISC-V 32-bit ISA, the size of a word is 32 bits (4 bytes).
Memory is always read and stored as words.</p>
<p>When the read or store address is not a multiple of 4 bytes, the operation is much more expensive.
In a simple benchmark, reading an unaligned <code>u32</code> value costs 12 cycles, versus 1 cycle for an aligned read.</p>
<p>All allocations will be aligned by default, and the compiler wants to help you, so this should usually not be an issue.</p>
<p>If you are defining structs that containing small primitive typed fields (e.g. <code>bool</code>, <code>u8</code>, <code>i16</code>) and access this data very frequently, you might consider paying extra care to the <a href="https://doc.rust-lang.org/reference/type-layout.html#the-alignment-modifiers" target="_blank" rel="noopener noreferrer">alignment of those fields</a>.
Additionally, if you are slicing into byte arrays, try to do so at word-aligned indices.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="when-reading-data-as-raw-bytes-use-envread_slice">When reading data as raw bytes, use <code>env::read_slice</code><a href="#when-reading-data-as-raw-bytes-use-envread_slice" class="hash-link" aria-label="Direct link to when-reading-data-as-raw-bytes-use-envread_slice" title="Direct link to when-reading-data-as-raw-bytes-use-envread_slice">​</a></h3>
<p>When reading input into the guest, <a href="https://docs.rs/risc0-zkvm/latest/risc0_zkvm/guest/env/fn.read.html" target="_blank" rel="noopener noreferrer"><code>env::read</code></a> is the main API to use.
It automatically deserializes the input bytes into structs, like in this <a href="https://github.com/risc0/risc0/blob/v0.19.0/examples/password-checker/methods/guest/src/main.rs#L24" target="_blank" rel="noopener noreferrer">snippet from the password checker example</a>.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">PasswordRequest</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token namespace">env</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">read</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the host code, <code>ExecutorEnvBuilder::write</code> function is used to serialize and write to input struct so that the guest can read it.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> request </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">PasswordRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">/* .. */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> env </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">ExecutorEnv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">builder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">write</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">build</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In most cases, these APIs are what you should use to send data to the guest.</p>
<p>However, when you need to read and work with data as raw bytes (or words), it is more efficient to use <a href="https://docs.rs/risc0-zkvm/0.19/risc0_zkvm/guest/env/fn.read_slice.html" target="_blank" rel="noopener noreferrer"><code>env::read_slice</code></a> or <code>env::stdin().read_to_end</code>.
Both methods do no (de)serialization and so do not need to copy or reinterpret the input data.
Examples of when this may be useful are if you are reading in image data as bytes, or reading data that is binary encoded from the source like with <a href="https://cbor.io/" target="_blank" rel="noopener noreferrer">CBOR</a>.</p>
<p>Here is a <a href="https://github.com/risc0/risc0/blob/v0.19.0/bonsai/examples/governance/methods/guest/src/bin/finalize_votes.rs#L88-L90" target="_blank" rel="noopener noreferrer">snippet from the Bonsai Governance example</a> showing how to read bytes.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> input_bytes </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">new</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token namespace">env</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">stdin</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">read_to_end</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> input_bytes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>On the host side, <code>ExecutorEnvBuilder::write_slice</code> is used to pass in the bytes.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> input_bytes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u8</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">b&quot;INPUT DATA&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">to_vec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> env </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">ExecutorEnv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">builder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">write_slice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">input_bytes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">build</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="when-you-only-need-part-of-the-input-data-try-merklizing-it">When you only need part of the input data, try Merklizing it<a href="#when-you-only-need-part-of-the-input-data-try-merklizing-it" class="hash-link" aria-label="Direct link to When you only need part of the input data, try Merklizing it" title="Direct link to When you only need part of the input data, try Merklizing it">​</a></h3>
<p>Some programs only need part of the whole available data.
<a href="https://github.com/risc0/risc0/tree/v0.19.0/examples/waldo" target="_blank" rel="noopener noreferrer">Where’s Waldo</a> is an example of this.
The full input is an image, but only the part with Waldo in it is needed.
Loading and hashing the whole image would be quite expensive, so instead the initial input for the guest is just the Merkle root and each chunk is loaded dynamically.
The guest verifies that the chunk is indeed part of the image by verifying the Merkle inclusion proof.</p>
<p>If you are writing a guest with a large input, and only part of it is needed for the computation, consider splitting it into some notion of a chunks and building it as a Merkle tree.
You can use the <a href="https://github.com/risc0/risc0/blob/main/examples/waldo/core/src/merkle.rs" target="_blank" rel="noopener noreferrer">code for Where’s Waldo</a> as a starting point.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cryptography-in-the-guest-can-utilize-accelerator-circuits">Cryptography in the guest can utilize accelerator circuits<a href="#cryptography-in-the-guest-can-utilize-accelerator-circuits" class="hash-link" aria-label="Direct link to Cryptography in the guest can utilize accelerator circuits" title="Direct link to Cryptography in the guest can utilize accelerator circuits">​</a></h3>
<p>RISC Zero’s riscv32im implementation includes a number of special purpose operations, including two “accelerators” for cryptographic functions: SHA-256 and <a href="https://github.com/risc0/risc0/pull/466" target="_blank" rel="noopener noreferrer">256-bit modular multiplication</a>.
By implementing these operations directly in the “hardware” of the zkVM, programs that use these accelerators execute faster and can be proven with significantly less resources <sup><a href="#user-content-fn-4" id="user-content-fnref-4" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup>.</p>
<p>For more information about cryptography acceleration, <a href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/acceleration">cryptography acceleration</a>.</p>
<p>Using the accelerator, a SHA-256 compress operation typically takes 68 cycles per 64-byte block and 6 cycles to initialize.
A 256-bit modular multiply takes 10 cycles.
This includes basic memory operation cycles, but does not include page-in or page-out operations that are triggered.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-access-is-synchronous">Memory access is synchronous<a href="#memory-access-is-synchronous" class="hash-link" aria-label="Direct link to Memory access is synchronous" title="Direct link to Memory access is synchronous">​</a></h3>
<p>On a physical CPU, memory access is asynchronous to register operations; meaning arithmetic or logic operations on registers can run while the CPU is waiting for the result from memory.
Because the memory fetch latency is quite large (100-150x the time to <code>add</code> two registers), this gives rise to techniques such as prefetching and speculative execution, implemented both at the processor and application levels.</p>
<p>In the zkVM, all memory operations are synchronous, regardless of if the data is currently paged-in.
<strong>Memory prefetching does not help (but can hurt) zkVM guest performance.</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="all-execution-is-single-threaded">All execution is single-threaded<a href="#all-execution-is-single-threaded" class="hash-link" aria-label="Direct link to All execution is single-threaded" title="Direct link to All execution is single-threaded">​</a></h3>
<p>The zkVM has one core and one thread of execution.
As a result, there is no need or use for multi-threading.
<strong>Using <code>async</code> routines, locking, or atomic operations in the guest can only slow the program down.</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-zkvm-has-no-pipelining-or-other-instruction-level-parallelism">The zkVM has no pipelining or other instruction-level parallelism.<a href="#the-zkvm-has-no-pipelining-or-other-instruction-level-parallelism" class="hash-link" aria-label="Direct link to The zkVM has no pipelining or other instruction-level parallelism." title="Direct link to The zkVM has no pipelining or other instruction-level parallelism.">​</a></h3>
<p>Modern processors have execution pipelines and <a href="https://en.wikipedia.org/wiki/Superscalar_processor" target="_blank" rel="noopener noreferrer">superscalar architectures</a> designed to <a href="https://en.wikipedia.org/wiki/Instruction-level_parallelism" target="_blank" rel="noopener noreferrer">execute instructions in parallel</a>.
Instruction throughput is much higher when the pipeline is kept full and independent execution units are utilized.
CPUs implement out-of-order and speculative execution, among other techniques to achieve this.</p>
<p>By comparison, RISC Zero’s riscv32im implementation is very simple.
Instructions will be read from the guest program and executed in the order chosen by the compiler.</p>
<p>Developers and compilers often use techniques such as pre-fetching, avoiding branches, or reordering instructions to maximize instruction-level parallelism.
<strong>These techniques have essentially no effect in the zkVM.</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prover-acceleration">Prover Acceleration<a href="#prover-acceleration" class="hash-link" aria-label="Direct link to Prover Acceleration" title="Direct link to Prover Acceleration">​</a></h2>
<p>You are probably interested in guest optimization in order to have faster proving times, to reduce compute costs, or both.
RISC Zero can leverage hardware accelerators, the ones made of real silicon this time, to accomplish both of these objectives. <sup><a href="#user-content-fn-5" id="user-content-fnref-5" data-footnote-ref="true" aria-describedby="footnote-label">5</a></sup></p>
<p>With an NVIDIA graphics card, proving can be accelerated through the <a href="https://developer.nvidia.com/cuda-toolkit" target="_blank" rel="noopener noreferrer">CUDA</a> implementation.
When running a zkVM application, a compatible version of the CUDA runtime needs to be installed.
When building the zkVM from source, a compatible version of the CUDA toolkit needs to be installed on the build machine, and the <code>cuda</code> feature enabled.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tldr-and-quick-wins">TL;DR and quick wins<a href="#tldr-and-quick-wins" class="hash-link" aria-label="Direct link to TL;DR and quick wins" title="Direct link to TL;DR and quick wins">​</a></h2>
<ul>
<li><a href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/profiling">Profile your applications</a> to find where cycles are being spent.</li>
<li>Try different <a href="https://doc.rust-lang.org/cargo/reference/profiles.html" target="_blank" rel="noopener noreferrer">compiler settings</a>
<ul>
<li>Setting <code>lto = &quot;thin&quot;</code> is sometimes faster than <code>lto = &quot;fat&quot;</code> or <code>lto = true</code>.</li>
<li>Sometimes <code>opt-level = 2</code> is faster than <code>3</code>. Try <code>s</code> and <code>z</code> too.</li>
<li>Try setting <code>codegen-units = 1</code>.</li>
</ul>
</li>
<li>When you need a map, use <code>BTreeMap</code> instead of <code>HashMap</code>.</li>
<li>When you need to hash data, use the <a href="https://dev.risczero.com/zkvm/developer-guide/acceleration" target="_blank" rel="noopener noreferrer">accelerated implementation of SHA-256</a>.</li>
<li>Look for places where you are copying or (de)serializing data when not necessary.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="appendix">Appendix<a href="#appendix" class="hash-link" aria-label="Direct link to Appendix" title="Direct link to Appendix">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rv32im-operations-with-cycle-counts">RV32IM Operations with Cycle Counts<a href="#rv32im-operations-with-cycle-counts" class="hash-link" aria-label="Direct link to RV32IM Operations with Cycle Counts" title="Direct link to RV32IM Operations with Cycle Counts">​</a></h3>
<p>Table from <a href="https://mark.theis.site/riscv/" target="_blank" rel="noopener noreferrer">https://mark.theis.site/riscv/</a>, with RISC Zero cycle counts added.</p>
<table><thead><tr><th>Assembly</th><th>Name</th><th>Pseudocode</th><th>RISC Zero Cycles</th></tr></thead><tbody><tr><td>LUI rd,imm</td><td>Load Upper Immediate</td><td>rd ← imm</td><td>1</td></tr><tr><td>AUIPC rd,offset</td><td>Add Upper Immediate to PC</td><td>rd ← pc + offset</td><td>1</td></tr><tr><td>JAL rd,offset</td><td>Jump and Link</td><td>rd ← pc + length(inst)pc ← pc + offset</td><td>1</td></tr><tr><td>JALR rd,rs1,offset</td><td>Jump and Link Register</td><td>rd ← pc + length(inst)pc ← (rs1 + offset) ∧ -2</td><td>1</td></tr><tr><td>BEQ rs1,rs2,offset</td><td>Branch Equal</td><td>if rs1 = rs2 then pc ← pc + offset</td><td>1</td></tr><tr><td>BNE rs1,rs2,offset</td><td>Branch Not Equal</td><td>if rs1 ≠ rs2 then pc ← pc + offset</td><td>1</td></tr><tr><td>BLT rs1,rs2,offset</td><td>Branch Less Than</td><td>if rs1 &lt; rs2 then pc ← pc + offset</td><td>1</td></tr><tr><td>BGE rs1,rs2,offset</td><td>Branch Greater than Equal</td><td>if rs1 ≥ rs2 then pc ← pc + offset</td><td>1</td></tr><tr><td>BLTU rs1,rs2,offset</td><td>Branch Less Than Unsigned</td><td>if rs1 &lt; rs2 then pc ← pc + offset</td><td>1</td></tr><tr><td>BGEU rs1,rs2,offset</td><td>Branch Greater than Equal Unsigned</td><td>if rs1 ≥ rs2 then pc ← pc + offset</td><td>1</td></tr><tr><td>LB rd,offset(rs1)</td><td>Load Byte</td><td>rd ← s8[rs1 + offset]</td><td>1 if <a href="#paging">paged-in</a> 1094 to 5130 otherwise</td></tr><tr><td>LH rd,offset(rs1)</td><td>Load Half</td><td>rd ← s16[rs1 + offset]</td><td>1 if <a href="#paging">paged-in</a> 1094 to 5130 otherwise</td></tr><tr><td>LW rd,offset(rs1)</td><td>Load Word</td><td>rd ← s32[rs1 + offset]</td><td>1 if <a href="#paging">paged-in</a> 1094 to 5130 otherwise</td></tr><tr><td>LBU rd,offset(rs1)</td><td>Load Byte Unsigned</td><td>rd ← u8[rs1 + offset]</td><td>1 if <a href="#paging">paged-in</a> 1094 to 5130 otherwise</td></tr><tr><td>LHU rd,offset(rs1)</td><td>Load Half Unsigned</td><td>rd ← u16[rs1 + offset]</td><td>1 if <a href="#paging">paged-in</a> 1094 to 5130 otherwise</td></tr><tr><td>SB rs2,offset(rs1)</td><td>Store Byte</td><td>u8[rs1 + offset] ← rs2</td><td>1 if <a href="#paging">paged-in</a> 1094 to 5130 otherwise</td></tr><tr><td>SH rs2,offset(rs1)</td><td>Store Half</td><td>u16[rs1 + offset] ← rs2</td><td>1 if <a href="#paging">paged-in</a> 1094 to 5130 otherwise</td></tr><tr><td>SW rs2,offset(rs1)</td><td>Store Word</td><td>u32[rs1 + offset] ← rs2</td><td>1 if <a href="#paging">paged-in</a> 1094 to 5130 otherwise</td></tr><tr><td>ADDI rd,rs1,imm</td><td>Add Immediate</td><td>rd ← rs1 + sx(imm)</td><td>1</td></tr><tr><td>SLTI rd,rs1,imm</td><td>Set Less Than Immediate</td><td>rd ← sx(rs1) &lt; sx(imm)</td><td>1</td></tr><tr><td>SLTIU rd,rs1,imm</td><td>Set Less Than Immediate Unsigned</td><td>rd ← ux(rs1) &lt; ux(imm)</td><td>1</td></tr><tr><td>XORI rd,rs1,imm</td><td>Xor Immediate</td><td>rd ← ux(rs1) ⊕ ux(imm)</td><td>2</td></tr><tr><td>ORI rd,rs1,imm</td><td>Or Immediate</td><td>rd ← ux(rs1) ∨ ux(imm)</td><td>2</td></tr><tr><td>ANDI rd,rs1,imm</td><td>And Immediate</td><td>rd ← ux(rs1) ∧ ux(imm)</td><td>2</td></tr><tr><td>SLLI rd,rs1,imm</td><td>Shift Left Logical Immediate</td><td>rd ← ux(rs1) « ux(imm)</td><td>1</td></tr><tr><td>SRLI rd,rs1,imm</td><td>Shift Right Logical Immediate</td><td>rd ← ux(rs1) » ux(imm)</td><td>2</td></tr><tr><td>SRAI rd,rs1,imm</td><td>Shift Right Arithmetic Immediate</td><td>rd ← sx(rs1) » ux(imm)</td><td>2</td></tr><tr><td>ADD rd,rs1,rs2</td><td>Add</td><td>rd ← sx(rs1) + sx(rs2)</td><td>1</td></tr><tr><td>SUB rd,rs1,rs2</td><td>Subtract</td><td>rd ← sx(rs1) - sx(rs2)</td><td>1</td></tr><tr><td>SLL rd,rs1,rs2</td><td>Shift Left Logical</td><td>rd ← ux(rs1) « rs2</td><td>1</td></tr><tr><td>SLT rd,rs1,rs2</td><td>Set Less Than</td><td>rd ← sx(rs1) &lt; sx(rs2)</td><td>1</td></tr><tr><td>SLTU rd,rs1,rs2</td><td>Set Less Than Unsigned</td><td>rd ← ux(rs1) &lt; ux(rs2)</td><td>1</td></tr><tr><td>XOR rd,rs1,rs2</td><td>Xor</td><td>rd ← ux(rs1) ⊕ ux(rs2)</td><td>2</td></tr><tr><td>SRL rd,rs1,rs2</td><td>Shift Right Logical</td><td>rd ← ux(rs1) » rs2</td><td>2</td></tr><tr><td>SRA rd,rs1,rs2</td><td>Shift Right Arithmetic</td><td>rd ← sx(rs1) » rs2</td><td>2</td></tr><tr><td>OR rd,rs1,rs2</td><td>Or</td><td>rd ← ux(rs1) ∨ ux(rs2)</td><td>2</td></tr><tr><td>AND rd,rs1,rs2</td><td>And</td><td>rd ← ux(rs1) ∧ ux(rs2)</td><td>2</td></tr><tr><td>MUL rd,rs1,rs2</td><td>Multiply</td><td>rd ← ux(rs1) × ux(rs2)</td><td>1</td></tr><tr><td>MULH rd,rs1,rs2</td><td>Multiply High Signed Signed</td><td>rd ← (sx(rs1) × sx(rs2)) » xlen</td><td>1</td></tr><tr><td>MULHSU rd,rs1,rs2</td><td>Multiply High Signed Unsigned</td><td>rd ← (sx(rs1) × ux(rs2)) » xlen</td><td>1</td></tr><tr><td>MULHU rd,rs1,rs2</td><td>Multiply High Unsigned Unsigned</td><td>rd ← (ux(rs1) × ux(rs2)) » xlen</td><td>1</td></tr><tr><td>DIV rd,rs1,rs2</td><td>Divide Signed</td><td>rd ← sx(rs1) ÷ sx(rs2)</td><td>2</td></tr><tr><td>DIVU rd,rs1,rs2</td><td>Divide Unsigned</td><td>rd ← ux(rs1) ÷ ux(rs2)</td><td>2</td></tr><tr><td>REM rd,rs1,rs2</td><td>Remainder Signed</td><td>rd ← sx(rs1) mod sx(rs2)</td><td>2</td></tr><tr><td>REMU rd,rs1,rs2</td><td>Remainder Unsigned</td><td>rd ← ux(rs1) mod ux(rs2)</td><td>2</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="risc-zero-ecall-operations">RISC Zero ECALL Operations<a href="#risc-zero-ecall-operations" class="hash-link" aria-label="Direct link to RISC Zero ECALL Operations" title="Direct link to RISC Zero ECALL Operations">​</a></h3>
<p>RISC-V specifies a mechanism for environment calls (ecalls), which may be specified by the vendor.
In RISC Zero’s zkVM, ecalls are specified for a number of core operations.
A short description and associated cycle counts are listed below.</p>
<table><thead><tr><th>Selector</th><th>Description</th><th>Operations</th><th>Cycles</th></tr></thead><tbody><tr><td>HALT</td><td>Halt execution</td><td>Set system exit code to a0. Load 32-bytes output digest from [a1]. Set output digest global. Halt execution.</td><td>1 + paging</td></tr><tr><td>SOFTWARE</td><td>Receive data from the host</td><td>Write host-provided data to the memory range [a0 .. a0 + a1 * 4]</td><td>1 + ⌈ a1 / 4 ⌉ + paging</td></tr><tr><td>SHA-256</td><td>SHA-256 hash</td><td>Compute the Merkle–Damgård compression of the region [a2 .. a2 + a3 * 64] with initial state [a1]. Write the digest to [a0].</td><td>6 + 68 * a2 + paging</td></tr><tr><td>BIGINT</td><td>256-bit modular operation</td><td>if a1 = 0, [a0] ← [a2] ⋅ [a3] (mod [a4])</td><td>10 + paging</td></tr></tbody></table>
<hr>
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-1">
<p>Modern processors have endlessly complex systems of pipelining, instruction-level parallelism, micro-ops and other details that bend the concept of “cycle” and make it impossible to say definitive how many “cycles” an operation takes.
It is still an good intuitive starting point and working model. <a href="#user-content-fnref-1" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-2">
<p>Here “sampling” is in quotes because the profiler actually captures the call stack at every cycle of program execution. Capturing a call stack on every cycle of execution is not done in most programs on physical CPUs for a few reasons:</p>
<ul>
<li>It would be cost prohibitive to do so for all but quite short program executions.</li>
<li>Introducing such heavy profiling would actually alter the performance characteristics in significant ways.</li>
</ul>
<p>In zkVM execution, executions are generally short and all execution is synchronous and is not subject to any deviations in behavior due to measurement overhead. <a href="#user-content-fnref-2" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-3">
<p>An implementation of cycle-accounting for paging operations is implemented in the <a href="https://github.com/risc0/risc0/blob/v0.19.0/risc0/zkvm/src/host/server/exec/monitor.rs#L30-L39" target="_blank" rel="noopener noreferrer">Executor</a>. (Link is to v0.19.0) <a href="#user-content-fnref-3" data-footnote-backref="" aria-label="Back to reference 3" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-4">
<p>This is similar to the cryptography support such as <a href="https://en.wikipedia.org/wiki/AES_instruction_set#x86_architecture_processors" target="_blank" rel="noopener noreferrer">AES-NI</a> or the <a href="https://en.wikipedia.org/wiki/Intel_SHA_extensions" target="_blank" rel="noopener noreferrer">SHA extensions</a> for x86 processors.
In both cases, the circuitry is extended to compute otherwise expensive operations in fewer instruction cycles. <a href="#user-content-fnref-4" data-footnote-backref="" aria-label="Back to reference 4" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-5">
<p>RISC Zero has an implementation for Apple’s Metal accelerators.
Unfortunately, it is does not work with the latest versions of Metal as of October 2023. See <a href="https://github.com/risc0/risc0/issues/937" target="_blank" rel="noopener noreferrer">https://github.com/risc0/risc0/issues/937</a> <a href="#user-content-fnref-5" data-footnote-backref="" aria-label="Back to reference 5" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/risc0/risc0/edit/main/website/api/zkvm/developer-guide/optimization.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/receipts"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Receipts 101</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/website-preview/risc0/risc0/pr/1127/api/next/zkvm/developer-guide/acceleration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cryptography Acceleration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a><ul><li><a href="#what-is-the-zkvm-really" class="table-of-contents__link toc-highlight">What is the zkVM, really?</a></li><li><a href="#what-is-a-cycle" class="table-of-contents__link toc-highlight">What is a “cycle”?</a></li></ul></li><li><a href="#general-techniques-and-advice" class="table-of-contents__link toc-highlight">General techniques and advice</a><ul><li><a href="#dont-assume-measure" class="table-of-contents__link toc-highlight">Don’t assume, measure.</a></li><li><a href="#measuring-by-printing-to-console" class="table-of-contents__link toc-highlight">Measuring by printing to console</a></li><li><a href="#profiling" class="table-of-contents__link toc-highlight">Profiling</a></li></ul></li><li><a href="#key-differences" class="table-of-contents__link toc-highlight">Key Differences</a><ul><li><a href="#most-risc-v-operations-take-exactly-one-cycle" class="table-of-contents__link toc-highlight">Most RISC-V operations take exactly one cycle</a></li><li><a href="#memory-access-costs-one-cycle-except-when-it-doesnt" class="table-of-contents__link toc-highlight">Memory access costs one cycle, except when it doesn’t</a></li><li><a href="#the-zkvm-does-not-have-native-floating-point-operations" class="table-of-contents__link toc-highlight">The zkVM does not have native floating point operations</a></li><li><a href="#unaligned-data-access-is-significantly-more-expensive" class="table-of-contents__link toc-highlight">Unaligned data access is significantly more expensive</a></li><li><a href="#when-reading-data-as-raw-bytes-use-envread_slice" class="table-of-contents__link toc-highlight">When reading data as raw bytes, use <code>env::read_slice</code></a></li><li><a href="#when-you-only-need-part-of-the-input-data-try-merklizing-it" class="table-of-contents__link toc-highlight">When you only need part of the input data, try Merklizing it</a></li><li><a href="#cryptography-in-the-guest-can-utilize-accelerator-circuits" class="table-of-contents__link toc-highlight">Cryptography in the guest can utilize accelerator circuits</a></li><li><a href="#memory-access-is-synchronous" class="table-of-contents__link toc-highlight">Memory access is synchronous</a></li><li><a href="#all-execution-is-single-threaded" class="table-of-contents__link toc-highlight">All execution is single-threaded</a></li><li><a href="#the-zkvm-has-no-pipelining-or-other-instruction-level-parallelism" class="table-of-contents__link toc-highlight">The zkVM has no pipelining or other instruction-level parallelism.</a></li></ul></li><li><a href="#prover-acceleration" class="table-of-contents__link toc-highlight">Prover Acceleration</a></li><li><a href="#tldr-and-quick-wins" class="table-of-contents__link toc-highlight">TL;DR and quick wins</a></li><li><a href="#appendix" class="table-of-contents__link toc-highlight">Appendix</a><ul><li><a href="#rv32im-operations-with-cycle-counts" class="table-of-contents__link toc-highlight">RV32IM Operations with Cycle Counts</a></li><li><a href="#risc-zero-ecall-operations" class="table-of-contents__link toc-highlight">RISC Zero ECALL Operations</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 RISC Zero, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>